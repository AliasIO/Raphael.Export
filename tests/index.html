<!DOCTYPE html>
<html>
	<head>
		<title>Raphael.Export Tests</title>
		<link rel="stylesheet" href="http://code.jquery.com/qunit/git/qunit.css" type="text/css"/>
    <style type="text/css">
      #visual-tests {
        font-family: Arial;
        margin: 16px 16px;
      }
      .paper {
        display: block;
        float: left;
        margin-right: 8px;
        width: 320px;
        height: 240px;
        border: 1px solid #ccc;
      }
    </style>
		<script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
		<script type="text/javascript" src="http://code.jquery.com/qunit/git/qunit.js"></script>
		<script type="text/javascript" src="raphael.js"></script>
		<script type="text/javascript" src="../raphael.export.js"></script>

		<script type="text/javascript">
			$(function() {
			  module('toSVG()');
			  
				test('is defined', function() {
					equal(typeof Raphael.fn.toSVG, 'function');
				});

				var
			   paper = Raphael('raphael-paper'),
					rect  = paper.rect(50, 40, 50, 50),
					text  = paper.text(40, 30, 'Hello World');
					;
					
        text.attr({'text-anchor' : 'left'});
        var svg = paper.toSVG();

				test('does not duplicate tag attributes', function() {
					ok(svg.indexOf(' x="50" x="50"') === -1, 'Duplicate x="50" found');
				});

				test('escapes quotes', function() {
					ok(svg.indexOf('&quot;Arial&quot') > -1, '"&quot;Arial&quot;" not found');
				});
				
				test('serializes text tag', function() {
				  var expected = 'Hello World';
				  var actual = svg.replace(/^.*?<text\b.*?<tspan\b.*?>(.*)<\/tspan><\/text>.*$/, '$1');
          equal(actual, expected);
				});
				
				if (Raphael.svg === true) {
          // Currently doesn't work on Firefox 3.6
				  document.getElementById('raphael-export-paper').innerHTML = svg;
				} else {
				  $('#raphael-export-paper').text("NOT SVG Browser: " + svg);
				}
			});
		</script>
	</head>
	<body>
		<h1 id="qunit-header">Raphael.Export Tests</h1>

		<h2 id="qunit-banner"></h2>

		<div id="qunit-testrunner-toolbar"></div>

		<h2 id="qunit-userAgent"></h2>

		<ol id="qunit-tests"></ol>
    <div id="qunit-fixture"></div>
		<div id="visual-tests">
      <h2>Visual Tests for SVG Browsers</h2>
      <p>Left = Raphael, Right = Raphael.Export (via DOM insert)</p>
			<div id="raphael-paper" class="paper"></div>
      <div id="raphael-export-paper" class="paper"></div>
		</div>
	</body>
</html>
